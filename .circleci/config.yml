version: 2
jobs:
  build:
    docker:
      - image: rocker/r-ver:3.5.3
    steps:
      - checkout
      - run:
          name: Install system dependencies
          command: apt-get update && apt-get install -y unixodbc unixodbc-dev curl xml2
      - run:
          name: Install devtools
          command: R -e "install.packages('Rcpp', dependencies = TRUE, repos='http://cran.us.r-project.org'); install.packages('devtools', repos='http://cran.us.r-project.org')"
      - run:
          name: Install package dependencies
          command: R -e "devtools::install_deps(dep = TRUE)"
      - run:
          name: Build package
          command: R CMD build .
      - run:
          name: Check package
          command: R CMD check *tar.gz
          
      - store_artifacts:
          path: /root/project/rdbcnxn.Rcheck/
  
#     working_directory: ~/main
#     docker:
#       - image: appsilon/ci-base:1.0
#     steps:
#       - checkout
#       - restore_cache:
#           keys:
#             - deps1-{{ .Branch }}-{{ checksum "DESCRIPTION" }}
#             - deps1-{{ .Branch }}
#             - deps1-
#       - run:
#           command: |
#             R -e 'devtools::install_deps(dependencies = TRUE)'
#       - save_cache:
#       
#       
#       
#           key: deps1-{{ .Branch }}-{{ checksum "DESCRIPTION" }}
#           paths:
#             - "/usr/local/lib/R/site-library"
#       - run:
#           command: |
#             R -e 'devtools::check()'
#       - store_artifacts:
#           path: man/
#           destination: man